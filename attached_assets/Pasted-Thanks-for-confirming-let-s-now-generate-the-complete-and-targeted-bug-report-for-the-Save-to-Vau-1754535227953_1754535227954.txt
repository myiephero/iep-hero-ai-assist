Thanks for confirming â€” letâ€™s now generate the complete and targeted bug report for the â€œSave to Vaultâ€ issue inside the Smart Letter Generator tool.

â¸»

ğŸ Smart Letter Generator â€“ â€œSave to Vaultâ€ Button Failing

Submit To: ğŸŸ£ Replit Agent
Label: bug, urgent, dashboard, smart-letter-generator

â¸»

ğŸ§© Problem Summary

The â€œSave to Vaultâ€ button in the Smart Letter Generator:
	â€¢	âœ… Appears visually
	â€¢	âœ… User is authenticated
	â€¢	âŒ Fails to trigger any insert or Supabase action
	â€¢	âœ… The â€œDownloadâ€ button works correctly, so it is isolated to Save functionality.

â¸»

ğŸ” Debugging Recap
	â€¢	App is using local PostgreSQL in dev, while frontend tries to write to Supabase
	â€¢	Logs confirmed: no request sent or recorded, no errors shown
	â€¢	Vault save requires a valid Supabase API call and auth token (supabase.auth.getUser() not firing or user not passed into backend)
	â€¢	Manual Test Insert works â†’ proves Supabase connectivity is fine if called properly

â¸»

âœ… Required Fixes

1. Ensure Auth Check Passes
	â€¢	Confirm supabase.auth.getUser() or session is passed to API route.
	â€¢	Button should not render at all if unauthenticated (add fallback UI like â€œLogin to Saveâ€).

2. Ensure API Endpoint Integration
	â€¢	Button must POST to:

/api/documents/generate

with payload:

{
  "student_id": "Kim Chee",
  "template": "Prior Written Notice",
  "content": "...full letter string..."
}


	â€¢	Insert into Supabaseâ€™s documents table.

3. Add Feedback / Debugging
	â€¢	Use console.log or toast feedback on:
	â€¢	Attempted insert
	â€¢	Success or error
	â€¢	Auth status

4. Fix Logic in Button

Check this:

if (!session) {
  alert("Login to save");
  return;
}

Ensure that the button:

onClick={handleSaveToVault}

correctly calls a fetch("/api/documents/generate", {...}) and includes headers.

â¸»

ğŸ” Reproduction Steps
	1.	Log in as parent@demo.com / demo123
	2.	Navigate to Smart Letter Generator
	3.	Fill out any letter
	4.	Click â€œSave to Vaultâ€
	5.	Observe: Nothing happens, no Supabase insert, no error or toast.

â¸»

âœ… Acceptance Criteria
	â€¢	Authenticated users can click â€œSave to Vaultâ€ and see success toast
	â€¢	Letter is inserted into documents table in Supabase
	â€¢	Unauthenticated users see â€œLogin to Saveâ€ instead of green button
	â€¢	API returns status 200 and logs response
	â€¢	Save errors are clearly logged in browser console

â¸»

Want me to post this directly as a GitHub issue for you? Or want it bundled with the Advocate dashboard fixes?