âœ… Hereâ€™s the full, clean agent prompt in Gold Standard Execution Protocol format for Step 3 patch fix. You will paste this directly into the Replit agent chat.

â¸»


ğŸ”§ PATCH INSTRUCTIONS: ISSUE-82-STEP-3 â€” Fix login failure caused by invalid Supabase column

ğŸ¯ OBJECTIVE:
Fix production login failure caused by a `400 Bad Request` Supabase error when querying a non-existent column `subscription_tier` in the `profiles` table. This is breaking the post-login `.select('role, email, subscription_tier')` fetch and preventing role hydration.

ğŸ‘¨â€ğŸ’» FILE LOCATION:
Locate the code handling login and Supabase profile fetch in:
`/lib/auth/signIn.ts` or the file where:
```ts
const { data: profile, error: profileError } = await supabase
  .from('profiles')
  .select('role, email, subscription_tier') // ğŸ”¥ This line causes the 400 error
  .eq('id', session.user.id)
  .single();

ğŸ› ï¸ REQUIRED FIX:
	1.	âœ… Remove the invalid column subscription_tier from the .select() call.
	2.	âœ… Final version should be:

const { data: profile, error: profileError } = await supabase
  .from('profiles')
  .select('role, email') // âœ… FIXED: Removed invalid column
  .eq('id', session.user.id)
  .single();

	3.	ğŸ§ª Confirm that login now fetches the profile.role and injects it properly into userContext.
	4.	ğŸ§  You should see this log on successful login:

[ISSUE-82-STEP-3] Login profile fetch successful: { role: 'advocate', email: 'erika.levine2017@gmail.com' }

ğŸ“¦ DEPLOYMENT:
Push fix live to Replit production build. No schema changes needed.

ğŸ§ª TEST CASES (on production):
	â€¢	âœ… Login: erika.levine2017@gmail.com â†’ should route to /dashboard-advocate
	â€¢	âœ… Role: Must come from Supabase profiles.role
	â€¢	âœ… No fallback logic used

ğŸš« DO NOT:
	â€¢	Reintroduce any default fallback roles
	â€¢	Add back subscription_tier unless itâ€™s re-added to the schema later

ğŸ”’ This patch is a blocker fix to enable all post-login routing now that fallback logic has been permanently removed per [ISSUE-82-STEP-3].

---

âœ… **Where to use this**:
Paste directly into the **Replit agent chat** window. This is a single, surgical task.

Once itâ€™s confirmed deployed, weâ€™ll proceed to `GitHub Issue #83: Role Assignment on Signup`.