[SEND TO: Replit Agent]

Step 3 â€“ Fix Advocate-Client Relationship Creation  
ðŸ”— GitHub Issue: https://github.com/myiephero/iep-hero-ai-assist/issues/64

ðŸŽ¯ OBJECTIVE: Fix POST /api/advocate/clients to successfully create an advocate-client relationship in Supabase without returning a 500 error.

ðŸ§­ EXECUTION INSTRUCTIONS:

1. Open `server/routes/advocate-clients.ts` (or wherever the `/api/advocate/clients` POST handler resides).

2. Temporarily wrap the handler logic in a try/catch block and log the following to debug payload and session context:  
console.log("ðŸ“¥ POST body:", req.body);  
console.log("ðŸ§‘â€ðŸ’¼ Session user:", session.user);

3. Confirm the Supabase table being inserted into (likely `advocate_clients`) and validate the schema expects:  
- advocate_id (from session.user.id)  
- parent_email (req.body.parentEmail)  
- client_name (req.body.clientName)  
- phone (req.body.phone)  
- notes (req.body.notes, optional)

4. Update the insert logic to explicitly define the payload with correct keys:  
const { error } = await supabaseAdmin  
.from("advocate_clients")  
.insert({  
â€ƒadvocate_id: session.user.id,  
â€ƒparent_email: req.body.parentEmail,  
â€ƒclient_name: req.body.clientName,  
â€ƒphone: req.body.phone,  
â€ƒnotes: req.body.notes || null,  
});  

if (error) {  
â€ƒconsole.error("âŒ Supabase insert failed:", error);  
â€ƒreturn res.status(500).json({ error: "Failed to create advocate-client relationship", details: error });  
}  

return res.status(200).json({ success: true });

5. Verify the following:  
âœ… Creating a parent via the Advocate dashboard returns a 200 success  
âœ… The new row appears in the `advocate_clients` table  
âœ… /api/advocate/clients now returns the newly linked parent

6. After confirming success, bust any service worker or frontend cache by running:  
echo '' > public/sw.js && rm -rf dist && npm run build

ðŸ“Œ Mark this step complete only if parent creation + fetching now both work cleanly for advocate user `erika.levine2017@gmail.com` (UUID: c89b7c1c-c60a-46fd-a45d-6f4b17f4cd13), and no 500 errors remain in dev console.